å‰è¨€

Â Â Â Â ä½œä¸ºä¸€ä¸ªé«˜çº§å‰ç«¯ç¨‹åºå‘˜ï¼Œæ•°æ®ç²¾åº¦é—®é¢˜ä¸€å®šä¸èƒ½å‡ºé”™ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯¹äºjsç²¾åº¦é—®é¢˜ï¼Œåº”è¯¥äº†è§£ä¸€äº›ä»€ä¹ˆå‘¢ï¼Ÿ

- Â jsæµ®ç‚¹æ•°è¿ç®—ä¸ºä»€ä¹ˆå‡ºç°ç²¾åº¦å¤±çœŸï¼Ÿ

- è§£å†³çš„æ–¹æ³•æœ‰å“ªäº›ï¼ŸÂ 

æƒ³è¦è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬å…ˆæ¥å¼„æ¸…æ¥šé—®é¢˜äº§ç”Ÿçš„æ ¹æœ¬åŸå› 

### åŸå› 

Â Â Â Â çŸ¥é“åŸå› å¿…é¡»äº†è§£ï¼Œjsæµ®ç‚¹æ•°è¿ç®—æ ‡å‡†å’Œè§„åˆ™ã€‚javascriptçš„æµ®ç‚¹æ•°è¿ç®—å°±æ˜¯é‡‡ç”¨äº†IEEE 754çš„æ ‡å‡†ã€‚

###### IEEE 754

Â Â Â Â IEEEäºŒè¿›åˆ¶æµ®ç‚¹æ•°ç®—æœ¯æ ‡å‡†[IEEE 754](https://zh.wikipedia.org/wiki/IEEE_754)æ˜¯20ä¸–çºª80å¹´ä»£ä»¥æ¥æœ€å¹¿æ³›ä½¿ç”¨çš„[æµ®ç‚¹æ•°](https://zh.wikipedia.org/wiki/%E6%B5%AE%E9%BB%9E%E6%95%B8 "æµ®ç‚¹æ•°")è¿ç®—æ ‡å‡†ã€‚

Â Â Â Â Â IEEE 754è§„å®šäº†å››ç§è¡¨ç¤ºæµ®ç‚¹æ•°å€¼çš„æ–¹å¼ï¼šå•ç²¾ç¡®åº¦ï¼ˆ32ä½ï¼‰ã€åŒç²¾ç¡®åº¦ï¼ˆ64ä½ï¼‰ã€å»¶ä¼¸å•ç²¾ç¡®åº¦ï¼ˆ43æ¯”ç‰¹ä»¥ä¸Šï¼Œå¾ˆå°‘ä½¿ç”¨ï¼‰ä¸å»¶ä¼¸åŒç²¾ç¡®åº¦ï¼ˆ79æ¯”ç‰¹ä»¥ä¸Šï¼Œé€šå¸¸ä»¥80ä½å®ç°ï¼‰ã€‚**å…¶ä¸­javascripté‡‡ç”¨çš„æ˜¯ åŒç²¾åº¦ï¼ˆ64ä½ï¼‰æµ®ç‚¹è¿ç®—è§„åˆ™**ã€‚

Â Â Â Â 

**IEEE754å­˜å‚¨å’Œè¿ç®—è§„åˆ™æ˜¯æ€ä¹ˆæ ·çš„å‘¢ï¼Ÿ**

<img src="https://pic1.zhimg.com/80/v2-2b7686dcb1203a738137bfd9805d11f8_1440w.png" title="" alt="" data-align="center">

ä¸€ä¸ªæµ®ç‚¹æ•°åœ¨è®¡ç®—æœºä¸­è¡¨ç¤ºä¸ºï¼š

Value = sign x exponent x function

ä¹Ÿå°±æ˜¯æµ®ç‚¹æ•°çš„å®é™…å€¼ç­‰äºç¬¦å·ä½ï¼ˆsignï¼‰ä¹˜ä»¥æŒ‡æ•°åç§»å€¼ï¼ˆexponentï¼‰å†ä¹˜ä»¥åˆ†æ•°å€¼ã€‚

- signï¼šæœ€é«˜æœ‰æ•ˆä½è¢«æŒ‡å®šä¸ºæ­£è´Ÿçš„ç¬¦å·ä½ï¼Œ 0è¡¨ç¤ºæ­£æ•°ï¼Œ1è¡¨ç¤ºè´Ÿæ•°

- exponentï¼šè¡¨ç¤ºæŒ‡æ•°åç§»å€¼ï¼Œç­‰äºæŒ‡æ•°å€¼åŠ ä¸ŠæŸä¸ªå›ºå®šçš„å€¼ã€‚å›ºå®šå€¼ä¸ºï¼š2^e - 1ï¼Œå…¶ä¸­eä¸ºå­˜å‚¨æŒ‡æ•°çš„é•¿åº¦ï¼Œæ¯”å¦‚32ä½çš„æ˜¯8ï¼Œ64ä½çš„ä¸º11

- fraction: ä¸ºå°¾æ•°ï¼Œå¯ä»¥ç†è§£ä¸ºå°æ•°ç‚¹éƒ¨åˆ†ã€‚è¶…å‡ºçš„éƒ¨åˆ†è‡ªåŠ¨è¿›ä¸€èˆé›¶ã€‚

Sä¸ºç¬¦å·ä½ï¼ŒExpä¸ºæŒ‡æ•°å­—ï¼ŒFractionä¸ºæœ‰æ•ˆæ•°å­—ã€‚æŒ‡æ•°éƒ¨åˆ†å³ä½¿ç”¨æ‰€è°“çš„åæ­£å€¼å½¢å¼è¡¨ç¤ºï¼Œåæ­£å€¼ä¸ºå®é™…çš„æŒ‡æ•°å¤§å°ä¸ä¸€ä¸ªå›ºå®šå€¼ï¼ˆ64ä½çš„æƒ…å†µæ˜¯1023ï¼‰çš„å’Œã€‚é‡‡ç”¨è¿™ç§æ–¹å¼è¡¨ç¤ºçš„ç›®çš„æ˜¯ç®€åŒ–æ¯”è¾ƒã€‚å› ä¸ºï¼ŒæŒ‡æ•°çš„å€¼å¯èƒ½ä¸ºæ­£ä¹Ÿå¯èƒ½ä¸ºè´Ÿï¼Œå¦‚æœé‡‡ç”¨è¡¥ç è¡¨ç¤ºçš„è¯ï¼Œå…¨ä½“ç¬¦å·ä½Så’ŒExpè‡ªèº«çš„ç¬¦å·ä½å°†å¯¼è‡´ä¸èƒ½ç®€å•çš„è¿›è¡Œå¤§å°æ¯”è¾ƒã€‚æ­£å› ä¸ºå¦‚æ­¤ï¼ŒæŒ‡æ•°éƒ¨åˆ†é€šå¸¸é‡‡ç”¨ä¸€ä¸ªæ— ç¬¦å·çš„æ­£æ•°å€¼å­˜å‚¨ã€‚åŒç²¾åº¦çš„æŒ‡æ•°éƒ¨åˆ†æ˜¯âˆ’1022ï½+1023åŠ ä¸Š1023ï¼ŒæŒ‡æ•°å€¼çš„å¤§å°ä»1ï½2046ï¼ˆ0ï¼ˆ2è¿›ä½å…¨ä¸º0ï¼‰å’Œ2047ï¼ˆ2è¿›ä½å…¨ä¸º1ï¼‰æ˜¯ç‰¹æ®Šå€¼ï¼‰ã€‚æµ®ç‚¹å°æ•°è®¡ç®—æ—¶ï¼ŒæŒ‡æ•°å€¼å‡å»åæ­£å€¼å°†æ˜¯å®é™…çš„æŒ‡æ•°å¤§å°ã€‚

|     | æ•°ç¬¦  | é˜¶ç   | å°¾æ•°  |
|:---:|:---:|:---:|:---:|
| 32ä½ | 1   | 8   | 23  |
| 64ä½ | 1   | 11  | 52  |

æˆ‘ä»¬æ¥ä¸ªä¾‹å­ğŸŒ°ï¼ŒæŠŠ10è¿›åˆ¶æ•°è½¬åŒ–ä½IEEE754 çš„32ä½æµ®ç‚¹æ•°è¡¨ç¤ºã€‚

ä¾‹å¦‚ï¼š 178.125

ç¬¬ä¸€æ­¥ï¼šå°†æ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†è½¬åŒ–ä¸ºäºŒè¿›åˆ¶

1. æ•´æ•°éƒ¨åˆ†ç”¨é™¤2å–ä½™çš„æ–¹æ³•ï¼Œæ±‚å¾—ï¼š10110010
2. å°æ•°éƒ¨åˆ†ç”¨ä¹˜2å–æ•´çš„æ–¹æ³•ï¼Œæ±‚å¾—ï¼š001
3. åˆèµ·æ¥ä¸ºï¼š 10110010.001

ç¬¬äºŒæ­¥ï¼šè½¬åŒ–ä¸ºäºŒè¿›åˆ¶æµ®ç‚¹æ•°ã€‚

Â Â Â Â å³æŠŠå°æ•°ç‚¹ç§»åŠ¨åˆ°åªæœ‰ä¸€ä½æ•´æ•°ï¼š1.0110010001 * 2^111ã€‚å·¦ç§»äº†7ä½äºŒè¿›åˆ¶ä¸º111ã€‚

ç¬¬ä¸‰æ­¥ï¼šç¡®å®šç¬¦å·ä½ï¼Œé˜¶ç ï¼Œå°¾æ•°

1. Â Â Â æ•°ç¬¦ï¼šç”±äºæµ®ç‚¹æ•°æ˜¯æ­£æ•°ï¼Œæ•…ä¸º0.(è´Ÿæ•°ä¸º1)

2. é˜¶ç  : é˜¶ç çš„è®¡ç®—å…¬å¼ï¼šé˜¶æ•° + åç§»é‡, é˜¶ç æ˜¯éœ€è¦ä½œç§»ç è¿ç®—ï¼Œåœ¨è½¬æ¢å‡ºæ¥çš„äºŒè¿›åˆ¶æ•°é‡Œï¼Œé˜¶æ•°æ˜¯111(åè¿›åˆ¶ä¸º7)ï¼Œå¯¹äºå•ç²¾åº¦çš„æµ®ç‚¹æ•°ï¼Œåç§»å€¼ä¸º01111111(127)[åç§»é‡çš„è®¡ç®—æ˜¯ï¼š2^(e-1)-1, eä¸ºé˜¶ç çš„ä½æ•°ï¼Œå³ä¸º8ï¼Œå› æ­¤åç§»å€¼æ˜¯127]ï¼Œå³ï¼š111+01111111 = 10000110

3. å°¾æ•°ï¼šå°æ•°ç‚¹åé¢çš„æ•°ï¼Œå³0110010001Â 

![](https://pic1.zhimg.com/80/v2-33e256020d4d251cd4baf2a3d400b628_1440w.jpg)

Â Â Â Â 

å¯èƒ½æœ‰ä¸ªç–‘é—®ï¼šå°æ•°ç‚¹å‰é¢çš„1å»å“ªé‡Œäº†ï¼Ÿç”±äºå°¾æ•°éƒ¨åˆ†æ˜¯è§„æ ¼åŒ–è¡¨ç¤ºçš„ï¼Œæœ€é«˜ä½æ€»æ˜¯â€œ1â€ï¼Œæ‰€ä»¥è¿™æ˜¯ç›´æ¥éšè—æ‰ï¼ŒåŒæ—¶ä¹ŸèŠ‚çœäº†1ä¸ªä½å‡ºæ¥å­˜å‚¨å°æ•°ï¼Œæé«˜ç²¾åº¦ã€‚

###### æµ®ç‚¹æ•°è¿ç®—

æ‰€ä»¥0.1 + 0.2 ä¸ºä»€ä¹ˆå‡ºç°ç²¾åº¦å¤±çœŸå‘¢ï¼Ÿ

é¦–å…ˆï¼Œåè¿›åˆ¶çš„0.1å’Œ0.2ä¼šè¢«è½¬æ¢æˆäºŒè¿›åˆ¶çš„ï¼Œä½†æ˜¯ç”±äºæµ®ç‚¹æ•°ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºæ—¶æ˜¯æ— ç©·çš„ï¼š

```
0.1 -> 0.0001 1001 1001 1001...(1100å¾ªç¯)
0.2 -> 0.0011 0011 0011 0011...(0011å¾ªç¯)
```

EEE 754 æ ‡å‡†çš„ 64 ä½åŒç²¾åº¦æµ®ç‚¹æ•°çš„å°æ•°éƒ¨åˆ†æœ€å¤šæ”¯æŒ53ä½äºŒè¿›åˆ¶ä½ï¼Œæ‰€ä»¥ä¸¤è€…ç›¸åŠ ä¹‹åå¾—åˆ°äºŒè¿›åˆ¶ä¸ºï¼š

```
0.0100110011001100110011001100110011001100110011001100 
```

å› æµ®ç‚¹æ•°å°æ•°ä½çš„é™åˆ¶è€Œæˆªæ–­çš„äºŒè¿›åˆ¶æ•°å­—ï¼Œå†è½¬æ¢ä¸ºåè¿›åˆ¶ï¼Œå°±æˆäº†0.30000000000000004ã€‚æ‰€ä»¥åœ¨è¿›è¡Œç®—æœ¯è®¡ç®—æ—¶ä¼šäº§ç”Ÿè¯¯å·®ã€‚

### è§£å†³æ–¹æ¡ˆ

è€ç”Ÿå¸¸è°ˆçš„è§£å†³æ–¹æ¡ˆæœ‰å¦‚ä¸‹å‡ ç§ï¼š

###### ä½¿ç”¨toFixed

Â Â Â Â æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ä½¿ç”¨toFixedæ¥å¤„ç†å°æ•°ï¼š

```
Â Â Â Â (0.1 + 0.2).toFixed(1) = '0.3'
```

è¿™ç§è™½ç„¶ç®€ä¾¿ï¼Œä½†æ˜¯å­˜åœ¨ä¸€äº›ç»“æœä¸ç²¾å‡†çš„é—®é¢˜ã€‚

```javascript
1.35.toFixed(1) // 1.4 æ­£ç¡®
1.335.toFixed(2) // 1.33  é”™è¯¯
1.3335.toFixed(3) // 1.333 é”™è¯¯
1.33335.toFixed(4) // 1.3334 æ­£ç¡®
1.333335.toFixed(5)  // 1.33333 é”™è¯¯
1.3333335.toFixed(6) // 1.333333 é”™è¯¯
```

###### åŒ–æ•´æ•°è¿ç®—

è¯¥æ–¹æ³•çš„ä¸»è¦æ€è·¯å°±æ˜¯æŠŠï¼Œå°æ•°è½¬åŒ–ä¸ºæ•´æ•°å†è¿›è¡Œè®¡ç®—ã€‚

```javascript
/**
 * å°æ•°ç‚¹åé¢ä¿ç•™ç¬¬ n ä½
 *
 * @param x åšè¿‘ä¼¼å¤„ç†çš„æ•°
 * @param n å°æ•°ç‚¹åç¬¬ n ä½
 * @returns è¿‘ä¼¼å¤„ç†åçš„æ•° 
 */
function roundFractional(x, n) {
  return Math.round(x * Math.pow(10, n)) / Math.pow(10, n);
}
```

æ€è·¯ï¼šnåˆ™æ˜¯è¦ä¿ç•™çš„å°æ•°ï¼Œå…ˆæ‰©å¤§10^nï¼Œç”¨Math.roundæŠŠè®¡ç®—ç»“æœå‘ä¸Šå–è¯å¤„ç†ï¼Œç„¶åé™¤ä»¥10^nã€‚

ç»“æœä¸ä»…æ²¡æœ‰å˜å¤§ï¼Œè€Œä¸”ç¡®ä¿æ˜¯æ•´æ•°å…œåº•ã€‚å¦‚æœæƒ³å‘ä¸‹å–è¯åˆ™ä½¿ç”¨Math.floorå‡½æ•°å³å¯ã€‚

è½¬å­—ç¬¦ä¸²

å¤§éƒ¨åˆ†ç¬¬ä¸‰æ–¹åº“å°±æ˜¯åŸºäºè¯¥æ–¹æ³•è¿›è¡Œå°è£…ï¼Œå¹¶ä¸”æ”¯æŒå¤§æ•°çš„å¤„ç†ã€‚æ¨èä½¿ç”¨ã€‚

```javascript
/*** method **
 *  add / subtract / multiply /divide
 * floatObj.add(0.1, 0.2) >> 0.3
 * floatObj.multiply(19.9, 100) >> 1990
 *
 */
var floatObj = function() {

    /*
     * åˆ¤æ–­objæ˜¯å¦ä¸ºä¸€ä¸ªæ•´æ•°
     */
    function isInteger(obj) {
        return Math.floor(obj) === obj
    }

    /*
     * å°†ä¸€ä¸ªæµ®ç‚¹æ•°è½¬æˆæ•´æ•°ï¼Œè¿”å›æ•´æ•°å’Œå€æ•°ã€‚å¦‚ 3.14 >> 314ï¼Œå€æ•°æ˜¯ 100
     * @param floatNum {number} å°æ•°
     * @return {object}
     *   {times:100, num: 314}
     */
    function toInteger(floatNum) {
        var ret = {times: 1, num: 0}
        if (isInteger(floatNum)) {
            ret.num = flatNum
            return ret
        }
        var strfi  = floatNum + ''
        var dotPos = strfi.indexOf('.')
        var len    = strfi.substr(dotPos+1).length
        var times  = Math.pow(10, len)
        var intNum = Number(floatNum.toString().replace('.',''))
        ret.times  = times
        ret.num    = intNum
        return ret
    }

    /*
     * æ ¸å¿ƒæ–¹æ³•ï¼Œå®ç°åŠ å‡ä¹˜é™¤è¿ç®—ï¼Œç¡®ä¿ä¸ä¸¢å¤±ç²¾åº¦
     * æ€è·¯ï¼šæŠŠå°æ•°æ”¾å¤§ä¸ºæ•´æ•°ï¼ˆä¹˜ï¼‰ï¼Œè¿›è¡Œç®—æœ¯è¿ç®—ï¼Œå†ç¼©å°ä¸ºå°æ•°ï¼ˆé™¤ï¼‰
     *
     * @param a {number} è¿ç®—æ•°1
     * @param b {number} è¿ç®—æ•°2
     * @param digits {number} ç²¾åº¦ï¼Œä¿ç•™çš„å°æ•°ç‚¹æ•°ï¼Œæ¯”å¦‚ 2, å³ä¿ç•™ä¸ºä¸¤ä½å°æ•°
     * @param op {string} è¿ç®—ç±»å‹ï¼Œæœ‰åŠ å‡ä¹˜é™¤ï¼ˆadd/subtract/multiply/divideï¼‰
     *
     */
    function operation(a, b, digits, op) {
        var o1 = toInteger(a)
        var o2 = toInteger(b)
        var n1 = o1.num
        var n2 = o2.num
        var t1 = o1.times
        var t2 = o2.times
        var max = t1 > t2 ? t1 : t2
        var result = null
        switch (op) {
            case 'add':
                if (t1 === t2) { // ä¸¤ä¸ªå°æ•°ä½æ•°ç›¸åŒ
                    result = n1 + n2
                } else if (t1 > t2) { // o1 å°æ•°ä½ å¤§äº o2
                    result = n1 + n2 * (t1 / t2)
                } else { // o1 å°æ•°ä½ å°äº o2
                    result = n1 * (t2 / t1) + n2
                }
                return result / max
            case 'subtract':
                if (t1 === t2) {
                    result = n1 - n2
                } else if (t1 > t2) {
                    result = n1 - n2 * (t1 / t2)
                } else {
                    result = n1 * (t2 / t1) - n2
                }
                return result / max
            case 'multiply':
                result = (n1 * n2) / (t1 * t2)
                return result
            case 'divide':
                result = (n1 / n2) * (t2 / t1)
                return result
        }
    }

    // åŠ å‡ä¹˜é™¤çš„å››ä¸ªæ¥å£
    function add(a, b, digits) {
        return operation(a, b, digits, 'add')
    }
    function subtract(a, b, digits) {
        return operation(a, b, digits, 'subtract')
    }
    function multiply(a, b, digits) {
        return operation(a, b, digits, 'multiply')
    }
    function divide(a, b, digits) {
        return operation(a, b, digits, 'divide')
    }

    // exports
    return {
        add: add,
        subtract: subtract,
        multiply: multiply,
        divide: divide
    }
}();
```

###### ç¬¬ä¸‰æ–¹åº“ï¼ˆbignumber.jsï¼‰æºç æµ…æ

```javascript
x = new Big(123.4567)
 y = Big('123456.7e-3')                 // 'new' is optional
 z = new Big(x)
 x.eq(y) && x.eq(z) && y.eq(z)
 â€‹
 â€‹
 0.3 - 0.1                              // 0.19999999999999998
 x = new Big(0.3)
 x.minus(0.1)                           // "0.2"
 x                                      // "0.3"

 function Big(n) {
  var x = this;
 â€‹
  // æ”¯æŒå‡½æ•°è°ƒç”¨æ–¹å¼è¿›è¡Œåˆå§‹åŒ–,å¯ä»¥ä¸ä½¿ç”¨newæ“ä½œç¬¦
  if (!(x instanceof Big)) return n === UNDEFINED ? _Big_() : new Big(n);
 â€‹
  // åŸå‹é“¾åˆ¤æ–­,ç¡®è®¤ä¼ å…¥å€¼æ˜¯å¦å·²ç»ä¸ºBigç±»çš„å®ä¾‹
  if (n instanceof Big) {
  x.s = n.s;
  x.e = n.e;
  x.c = n.c.slice();
  } else {
  if (typeof n !== 'string') {
  if (Big.strict === true) {
  throw TypeError(INVALID + 'number');
  }
 â€‹
  // ç¡®å®šæ˜¯å¦ä¸º-0,å¦‚æœä¸æ˜¯,è½¬åŒ–ä¸ºå­—ç¬¦ä¸².
  n = n === 0 && 1 / n < 0 ? '-0' : String(n);
  }
 â€‹
  // parseå‡½æ•°åªæ¥å—å­—ç¬¦ä¸²å‚æ•°
  parse(x, n);
  }
 â€‹
  x.constructor = Big;
 }

 function parse(x, n) {
  var e, i, nl;
 â€‹
  if (!NUMERIC.test(n)) {
  throw Error(INVALID + 'number');
  }
 â€‹
  // åˆ¤æ–­ç¬¦å·,æ˜¯æ­£æ•°è¿˜æ˜¯è´Ÿæ•°
  x.s = n.charAt(0) == '-' ? (n = n.slice(1), -1) : 1;
 â€‹
  // åˆ¤æ–­æ˜¯å¦æœ‰å°æ•°ç‚¹
  if ((e = n.indexOf('.')) > -1) n = n.replace('.', '');
 â€‹
  // åˆ¤æ–­æ˜¯å¦ä¸ºç§‘å­¦è®¡æ•°æ³•
  if ((i = n.search(/e/i)) > 0) {
 â€‹
  // ç¡®å®šæŒ‡æ•°å€¼
  if (e < 0) e = i;
  e += +n.slice(i + 1);
  n = n.substring(0, i);
  } else if (e < 0) {
 â€‹
  // æ˜¯ä¸€ä¸ªæ­£æ•´æ•°
  e = n.length;
  }
 â€‹
  nl = n.length;
 â€‹
  // ç¡®å®šæ•°å­—å‰é¢æœ‰æ²¡æœ‰0,ä¾‹å¦‚0123è¿™ç§0
  for (i = 0; i < nl && n.charAt(i) == '0';) ++i;
 â€‹
  if (i == nl) {
 â€‹
  // Zero.
  x.c = [x.e = 0];
  } else {
 â€‹
  // ç¡®å®šæ•°å­—åé¢çš„0,ä¾‹å¦‚1.230è¿™ç§0
  for (; nl > 0 && n.charAt(--nl) == '0';);
  x.e = e - i - 1;
  x.c = [];
 â€‹
  // æŠŠå­—ç¬¦ä¸²è½¬æ¢æˆæ•°ç»„è¿›è¡Œå­˜å‚¨,è¿™ä¸ªæ—¶å€™å·²ç»å»æ‰äº†å‰é¢çš„0å’Œåé¢çš„0
  for (e = 0; i <= nl;) x.c[e++] = +n.charAt(i++);
  }
 â€‹
  return x;
 }

 P.plus = P.add = function (y) {
  var t,
  x = this,
  Big = x.constructor,
  a = x.s,
  // æ‰€æœ‰æ“ä½œå‡è½¬åŒ–ä¸ºä¸¤ä¸ªBigç±»çš„å®ä¾‹è¿›è¡Œè¿ç®—,æ–¹ä¾¿å¤„ç†
  b = (y = new Big(y)).s;
 â€‹
  // åˆ¤æ–­ç¬¦å·æ˜¯ä¸æ˜¯ä¸ç›¸ç­‰,å³ä¸€ä¸ªä¸ºæ­£,ä¸€ä¸ªä¸ºè´Ÿ
  if (a != b) {
  y.s = -b;
  return x.minus(y);
  }
 â€‹
  var xe = x.e,
  xc = x.c,
  ye = y.e,
  yc = y.c;
 â€‹
  // åˆ¤æ–­æ˜¯å¦æŸä¸ªå€¼æ˜¯0
  if (!xc[0] || !yc[0]) return yc[0] ? y : new Big(xc[0] ? x : a * 0);
 â€‹
  // æ‹·è´ä¸€ä»½æ•°ç»„,é¿å…å½±å“åŸå®ä¾‹
  xc = xc.slice();
 â€‹
  // å¡«0æ¥ä¿è¯è¿ç®—æ—¶çš„ä½æ•°ç›¸ç­‰
  // æ³¨æ„,reverseå‡½æ•°æ¯”unshiftå‡½æ•°å¿«
  if (a = xe - ye) {
  if (a > 0) {
  ye = xe;
  t = yc;
  } else {
  a = -a;
  t = xc;
  }
 â€‹
  t.reverse();
  for (; a--;) t.push(0);
  t.reverse();
  }
 â€‹
  // æŠŠxcæ”¾åˆ°ä¸€ä¸ªæ›´é•¿çš„æ•°ç»„ä¸­,æ–¹ä¾¿åç»­å¾ªç¯åŠ æ³•æ“ä½œ
  if (xc.length - yc.length < 0) {
  t = yc;
  yc = xc;
  xc = t;
  }
 â€‹
  a = yc.length;
 â€‹
  // æ‰§è¡ŒåŠ æ³•æ“ä½œ,å°†æ•°å€¼ä¿å­˜åˆ°xcä¸­
  for (b = 0; a; xc[a] %= 10) b = (xc[--a] = xc[a] + yc[a] + b) / 10 | 0;
 â€‹
  // ä¸éœ€è¦æ£€æŸ¥0,å› ä¸º +x + +y != 0 ,åŒæ—¶ -x + -y != 0
 â€‹
  if (b) {
  xc.unshift(b);
  ++ye;
  }
 â€‹
  // åˆ é™¤ç»“å°¾çš„0
  for (a = xc.length; xc[--a] === 0;) xc.pop();
 â€‹
  y.c = xc;
  y.e = ye;
 â€‹
  return y;
 };

 P.times = P.mul = function (y) {
  var c,
  x = this,
  Big = x.constructor,
  xc = x.c,
  yc = (y = new Big(y)).c,
  a = xc.length,
  b = yc.length,
  i = x.e,
  j = y.e;
 â€‹
  // ç¬¦å·æ¯”è¾ƒç¡®å®šæœ€ç»ˆçš„ç¬¦å·æ˜¯ä¸ºæ­£è¿˜æ˜¯ä¸ºè´Ÿ
  y.s = x.s == y.s ? 1 : -1;
 â€‹
  // å¦‚æœæœ‰ä¸€ä¸ªå€¼æ˜¯0,é‚£ä¹ˆè¿”å›0å³å¯
  if (!xc[0] || !yc[0]) return new Big(y.s * 0);
 â€‹
  // å°æ•°ç‚¹åˆå§‹åŒ–ä¸ºx.e+y.e,è¿™æ˜¯æˆ‘ä»¬åœ¨ä¸¤ä¸ªå°æ•°ç›¸ä¹˜çš„æ—¶å€™,å°æ•°ç‚¹çš„è®¡ç®—è§„åˆ™
  y.e = i + j;
 â€‹
  // è¿™ä¸€æ­¥ä¹Ÿæ˜¯ä¿è¯xcçš„é•¿åº¦æ°¸è¿œä¸å°äºycçš„é•¿åº¦,å› ä¸ºè¦éå†xcæ¥è¿›è¡Œè¿ç®—
  if (a < b) {
  c = xc;
  xc = yc;
  yc = c;
  j = a;
  a = b;
  b = j;
  }
 â€‹
  // ç”¨0æ¥åˆå§‹åŒ–ç»“æœæ•°ç»„
  for (c = new Array(j = a + b); j--;) c[j] = 0;
 â€‹
  // iåˆå§‹åŒ–ä¸ºxcçš„é•¿åº¦
  for (i = b; i--;) {
  b = 0;
 â€‹
  // aæ˜¯ycçš„é•¿åº¦
  for (j = a + i; j > i;) {
 â€‹
  // xcçš„ä¸€ä½ä¹˜ä»¥ycçš„ä¸€ä½,å¾—åˆ°æœ€ç»ˆçš„ç»“æœå€¼,ä¿å­˜ä¸‹æ¥
  b = c[j] + yc[i] * xc[j - i - 1] + b;
  c[j--] = b % 10;
 â€‹
  b = b / 10 | 0;
  }
 â€‹
  c[j] = b;
  }
 â€‹
  // å¦‚æœæœ‰è¿›ä½,é‚£ä¹ˆå°±è°ƒæ•´å°æ•°ç‚¹çš„ä½æ•°(å¢åŠ y.e),å¦åˆ™å°±åˆ é™¤æœ€å‰é¢çš„0
  if (b) ++y.e;
  else c.shift();
 â€‹
  // åˆ é™¤åé¢çš„0
  for (i = c.length; !c[--i];) c.pop();
  y.c = c;
 â€‹
  return y;
 };

 P.round = function (dp, rm) {
  if (dp === UNDEFINED) dp = 0;
  else if (dp !== ~~dp || dp < -MAX_DP || dp > MAX_DP) {
  throw Error(INVALID_DP);
  }
  return round(new this.constructor(this), dp + this.e + 1, rm);
 };
 â€‹
 function round(x, sd, rm, more) {
  var xc = x.c;
 â€‹
  if (rm === UNDEFINED) rm = Big.RM;
  if (rm !== 0 && rm !== 1 && rm !== 2 && rm !== 3) {
  throw Error(INVALID_RM);
  }
 â€‹
  if (sd < 1) {
  // å…œåº•æƒ…å†µ,ç²¾åº¦å°äº1,é»˜è®¤æœ‰æ•ˆå€¼ä¸º1
  more =
  rm === 3 && (more || !!xc[0]) || sd === 0 && (
  rm === 1 && xc[0] >= 5 ||
  rm === 2 && (xc[0] > 5 || xc[0] === 5 && (more || xc[1] !== UNDEFINED))
  );
 â€‹
  xc.length = 1;
 â€‹
  if (more) {
 â€‹
  // 1, 0.1, 0.01, 0.001, 0.0001 ç­‰ç­‰
  x.e = x.e - sd + 1;
  xc[0] = 1;
  } else {
  // å®šä¹‰ä¸º0
  xc[0] = x.e = 0;
  }
  } else if (sd < xc.length) {
 â€‹
  // xcæ•°ç»„ä¸­,åœ¨ç²¾åº¦ä¹‹åçš„çº¸ä¼šè¢«èˆå¼ƒå–æ•´
  more =
  rm === 1 && xc[sd] >= 5 ||
  rm === 2 && (xc[sd] > 5 || xc[sd] === 5 &&
  (more || xc[sd + 1] !== UNDEFINED || xc[sd - 1] & 1)) ||
  rm === 3 && (more || !!xc[0]);
 â€‹
  // åˆ é™¤æ‰€éœ€ç²¾åº¦åçš„æ•°ç»„å€¼
  xc.length = sd--;
 â€‹
  // å–æ•´æ–¹å¼åˆ¤æ–­
  if (more) {
 â€‹
  // å››èˆäº”å…¥å¯èƒ½æ„å‘³ç€å‰ä¸€ä¸ªæ•°å­—å¿…é¡»å››èˆäº”å…¥,æ‰€ä»¥è¿™ä¸ªæ—¶å€™éœ€è¦å¡«0
  for (; ++xc[sd] > 9;) {
  xc[sd] = 0;
  if (!sd--) {
  ++x.e;
  xc.unshift(1);
  }
  }
  }
 â€‹
  // åˆ é™¤å°æ•°ç‚¹åé¢çš„0
  for (sd = xc.length; !xc[--sd];) xc.pop();
  }
 â€‹
  return x;
 }
```

åœ¨æ­£å¸¸çš„é€»è¾‘ä¸­ï¼Œæˆ‘ä»¬æ ¹æ®ç²¾åº¦èˆå¼ƒäº†ç²¾åº¦åçš„å€¼ï¼Œç»Ÿä¸€å¡«å……0è¿›è¡Œè¡¨ç¤ºã€‚

é€šè¿‡å†…éƒ¨çš„`round`å‡½æ•°çš„å®ç°å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æœ€å¼€å§‹æˆ‘ä»¬è¿›è¡Œäº†å¼‚å¸¸çš„å…œåº•æ£€æµ‹ï¼Œæ’é™¤äº†ä¸¤ç§å¼‚å¸¸çš„æƒ…å†µã€‚ä¸€ç§æ˜¯å‚æ•°é”™è¯¯ï¼Œç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼›å¦ä¸€ç§æ˜¯ç²¾åº¦å°äº1çš„æƒ…å†µï¼Œåœ¨è¿™ä¸ªæ—¶å€™ï¼Œå®šä¹‰äº†å…œåº•çš„å€¼1ã€‚

åœ¨big.jsä¸­ï¼Œæ‰€æœ‰çš„å–æ•´è¿ç®—éƒ½è°ƒç”¨äº†å†…éƒ¨çš„ä¸€ä¸ª`round`å‡½æ•°ã€‚é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±ä»¥APIä¸­çš„`round`æ–¹æ³•ä¸ºä¾‹ã€‚è¿™ä¸ªæ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå€¼`dp`ä»£è¡¨ç€å°æ•°åæœ‰æ•ˆå€¼çš„ä½æ•°ï¼Œç¬¬äºŒä¸ª`rm`ä»£è¡¨äº†å–æ•´çš„æ–¹å¼ã€‚

å‚è€ƒèµ„æ–™ï¼š

- [æµ®ç‚¹æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤º(IEEE 754æ ‡å‡†)](https://zhuanlan.zhihu.com/p/144697348)
- [IEEE 754 - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦](https://zh.wikipedia.org/wiki/IEEE_754#cite_note-2)
- [JSä¸­æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜ - æ˜é‡‘](https://juejin.cn/post/6844903572979597319)
- https://segmentfault.com/a/1190000013431163